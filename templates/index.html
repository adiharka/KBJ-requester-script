<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Caller</title>
    <script>
        function startApiCalls() {
            fetch('/start')
                .then(response => response.json())
                .then(data => alert(data.message));
        }

        function setIntervalValue() {
            const intervalInput = document.getElementById('interval').value;
            fetch('/set_interval', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ interval: parseInt(intervalInput) })
            })
            .then(response => response.json())
            .then(data => alert(data.message));
        }

        function stopApiCalls() {
            fetch('/stop')
                .then(response => response.json())
                .then(data => alert(data.message));
        }

        function fetchUpdates() {
            fetch('/get_updates')
                .then(response => response.json())
                .then(data => {
                    const statusDiv = document.getElementById('status');
                    data.forEach(update => {
                        const timestamp = new Date().toLocaleTimeString();
                        const p = document.createElement('p');
                        p.textContent = `Time: ${timestamp} --> Request endpoint: ${update.endpoint}, Request time: ${update.request_time} seconds, Response status code: ${update.status_code}`;
                        // Insert the new paragraph at the top
                        statusDiv.insertBefore(p, statusDiv.firstChild);
                    });
                });
        }

        setInterval(fetchUpdates, 1000); // Poll every second
    </script>
</head>
<body>
    <h1>API Caller</h1>
    <button onclick="startApiCalls()">Start API Calls</button>
    <input type="number" id="interval" placeholder="Set Interval (seconds)" />
    <button onclick="setIntervalValue()">Set Interval</button>
    <button onclick="stopApiCalls()">Stop API Calls</button>
    <div id="status" style="margin-top: 1rem; padding: 1rem; border: 1px black solid; border-radius: 1rem">
        <p>API calls not started.</p>
    </div>
</body>
</html>
